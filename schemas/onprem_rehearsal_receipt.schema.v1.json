{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "onprem rehearsal receipt schema v1",
  "type": "object",
  "required": [
    "onprem_rehearsal_receipt_schema_version",
    "run_id",
    "git_sha",
    "overlay",
    "status",
    "failure_code",
    "rendered_resource_count",
    "sampled_line_count",
    "sampled_line_sha256",
    "sampled_output_sha256",
    "rendered_manifest_sha256",
    "write_receipt",
    "apply_executed",
    "commands"
  ],
  "properties": {
    "onprem_rehearsal_receipt_schema_version": {
      "type": "integer",
      "enum": [
        1
      ]
    },
    "run_id": {
      "type": "string"
    },
    "git_sha": {
      "type": "string"
    },
    "overlay": {
      "type": "string"
    },
    "status": {
      "type": "string",
      "enum": [
        "success",
        "failed"
      ]
    },
    "failure_code": {
      "type": [
        "string",
        "null"
      ],
      "enum": [
        "DOCTOR_FAILED",
        "OVERLAY_RENDER_FAILED",
        "OVERLAY_RESOURCES_MISSING",
        "RECEIPT_SCHEMA_INVALID",
        "RECEIPT_WRITE_FAILED",
        "APPLY_FAILED",
        "UNEXPECTED_FAILURE",
        null
      ]
    },
    "rendered_resource_count": {
      "type": "integer",
      "minimum": 0
    },
    "sampled_line_count": {
      "type": "integer",
      "minimum": 0
    },
    "sampled_line_sha256": {
      "type": "array",
      "items": {
        "type": "string",
        "pattern": "^[a-f0-9]{64}$"
      }
    },
    "sampled_output_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$"
    },
    "rendered_manifest_sha256": {
      "type": "string",
      "pattern": "^[a-f0-9]{64}$"
    },
    "write_receipt": {
      "type": "boolean"
    },
    "apply_executed": {
      "type": "boolean"
    },
    "commands": {
      "type": "object",
      "required": [
        "doctor",
        "render",
        "apply"
      ],
      "properties": {
        "doctor": {
          "type": "string"
        },
        "render": {
          "type": "string"
        },
        "apply": {
          "type": "string"
        }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
